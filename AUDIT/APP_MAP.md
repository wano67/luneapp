# Application Map
- **Routing shells**: `src/app/layout.tsx` (root), `(marketing)/layout.tsx` for public pages, `src/app/app/layout.tsx` for authenticated shell; business context layout at `src/app/app/pro/[businessId]/layout.tsx` (guards, sidebar).
- **Marketing** (`/(marketing)`): `/` (home), `/about`, `/features`, `/pricing`, `/contact`, `/login`, `/register`, legal pages. Mostly server components; footer/nav links in `src/components/marketing/MarketingFooter.tsx` and `MarketingNavbar.tsx`.
- **Workspace hub** (`/app`):
  - **Account**: `/app/account` + subpages `/profile`, `/preferences`, `/security`; client components hitting `/api/account/*` (e.g., `src/app/app/account/profile/page.tsx` POST `/api/account/profile`).
  - **Docs/Focus/Performance**: `/app/docs`, `/app/focus`, `/app/performance/*` (zero references; likely legacy dashboards).
  - **Personal finance**: `/app/personal` with accounts/transactions/budgets/revenus/epargne; heavy client page `src/app/app/personal/transactions/page.tsx` uses `/api/personal/accounts`, `/api/personal/categories`, `/api/personal/transactions`, import/bulk-delete.
  - **Pro workspace**: `/app/pro` landing (`src/app/app/pro/page.tsx`), business picker `/app/pro/businesses`, then `/app/pro/[businessId]/**` for CRM/finances/services/tasks/settings. Tabs/cards via `src/app/app/AppShell.tsx`, `AppSidebar.tsx`, `ProDashboard.tsx`.
- **Key Pro areas & API usage**
  - **Clients**: `/app/pro/[businessId]/clients` list; `/clients/[clientId]` uses tabs (`ClientInfoTab.tsx`, `ClientDocumentsTab.tsx`, `ClientAccountingTab.tsx`, `ClientInteractionsTab.tsx`) calling `/api/pro/businesses/{id}/clients/*`, documents endpoints, payments, interactions.
  - **Finances**: `/finances`, `/finances/expenses/[expenseId]`, `/finances/invoices/[invoiceId]`, `/finances/payments` hitting `/api/pro/businesses/{id}/finances*`, `/payments`, `/invoices/{invoiceId}/pdf`.
  - **Projects/Tasks/Processes**: pages under `/projects`, `/tasks`, `/process` call respective APIs (`/api/pro/businesses/{id}/projects*`, `/tasks*`, `/processes*`).
  - **Settings**: `/settings`, `/settings/team`, `/settings/billing|taxes|integrations|permissions` backed by `/api/pro/businesses/{id}/settings`, `/members`, `/invites`.
- **API surface (App Router)**: All endpoints under `src/app/api/**`. Auth/session (`/api/auth/*`), account, personal wallet (`/api/personal/*`), Pro business CRUD and nested resources. Most Pro routes enforce `requireAuthPro` + `requireBusinessRole`; CSRF via `assertSameOrigin` on mutating handlers; rate limits on auth, invites, uploads, interactions, clients, payments.
- **Uploads & documents**: `/api/pro/businesses/{id}/clients/{clientId}/documents` (GET/POST) and `/api/pro/businesses/{id}/documents/{docId}/view|download`; storage via `src/server/storage/local.ts` with MIME/size checks and business ownership filtering.
- **Logo/Favicon fetch (SSRF-sensitive)**: `/api/logo` and `/api/favicon` implement private-host blocks, timeouts, size caps via `src/lib/logo/validateLogoUrl.ts` and `getLogoCandidates.ts`.
