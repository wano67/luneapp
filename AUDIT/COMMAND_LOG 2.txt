1. cat /Users/diwan/.codex/skills/.system/plan/SKILL.md — read plan skill instructions.
2. node -v — capture Node version.
3. pnpm -v — capture pnpm version.
4. pnpm prisma -v — capture Prisma client/engine versions.
5. pnpm -s lint — run lint baseline.
6. pnpm -s typecheck — run typecheck baseline.
7. NEXT_DISABLE_TURBOPACK=1 pnpm -s build — run production build.
8. rg --files -g 'page.tsx' src/app — list app pages.
9. rg --files -g 'layout.tsx' src/app — list app layouts.
10. rg --files -g 'loading.tsx' src/app — check loading boundaries (no results).
11. rg --files -g 'error.tsx' src/app — check error boundaries (no results).
12. rg --files -g 'not-found.tsx' src/app — check not-found components (no results).
13. rg --files -g 'route.ts' src/app/api — list API routes.
14. sed -n '1,200p' src/app/api/pro/businesses/[businessId]/payments/route.ts — inspect payments API (first attempt failed due to shell globbing).
15. sed -n '1,200p' 'src/app/api/pro/businesses/[businessId]/payments/route.ts' — inspect payments API (quoted path).
16. node - <<'EOF' ... (first ROUTES_PAGES generator) — attempted routes CSV; failed due to regex escape.
17. node - <<'EOF' ... (fixed ROUTES_PAGES generator) — generate AUDIT/ROUTES_PAGES.csv.
18. head -n 8 AUDIT/ROUTES_PAGES.csv — spot-check routes output.
19. node - <<'EOF' ... (layout fix rerun) — regenerate AUDIT/ROUTES_PAGES.csv without '/.' paths.
20. head -n 8 AUDIT/ROUTES_PAGES.csv — verify corrected paths.
21. node - <<'EOF' ... (API_SECURITY generator) — generate AUDIT/API_SECURITY.csv.
22. rg "assertSameOrigin" src/app/api — map CSRF coverage.
23. sed -n '1,220p' src/app/api/logo/route.ts — review SSRF protections.
24. sed -n '220,440p' src/app/api/logo/route.ts — review remainder of logo route.
25. sed -n '1,220p' 'src/app/api/pro/businesses/[businessId]/documents/[documentId]/view/route.ts' — inspect document view API.
26. sed -n '1,320p' 'src/app/api/pro/businesses/[businessId]/clients/[clientId]/documents/route.ts' — inspect document list/upload API.
27. sed -n '1,220p' 'src/app/api/pro/businesses/[businessId]/documents/[documentId]/download/route.ts' — inspect document download API.
28. rg "model BusinessDocument" -n prisma/schema.prisma — confirm model exists.
29. sed -n '1000,1070p' prisma/schema.prisma — view BusinessDocument schema.
30. ls src/components/pro/clients — locate client tab components.
31. sed -n '1,220p' src/components/pro/clients/ClientInfoTab.tsx — review client info UI.
32. sed -n '220,440p' src/components/pro/clients/ClientInfoTab.tsx — continue client info UI review.
33. find src -name '*.ts*' -not -path '*/node_modules/*' -print0 | xargs -0 wc -l | sort -nr | head -n 20 — locate largest files (including generated).
34. find src -name '*.ts*' -not -path '*/node_modules/*' | grep -v 'generated' | xargs wc -l | sort -nr | head -n 20 — largest handwritten files.
35. pnpm dlx depcheck — unused dependency scan.
36. pnpm dlx ts-prune -p tsconfig.json — unused exports scan.
37. node - <<'EOF' ... (zero-reference finder) — list routes/pages with referenced_by_count=0.
38. sed -n '1,220p' 'src/app/api/pro/businesses/[businessId]/interactions/route.ts' — review interactions API.
39. sed -n '1,220p' 'src/app/api/pro/businesses/[businessId]/interactions/[interactionId]/route.ts' — review interactions detail API.
40. for f in $(rg -l "\[businessId\]" src/app/api); do if ! rg -q "requireBusinessRole" "$f"; then echo "$f"; fi; done — sanity-check RBAC presence on business routes.
41. sed -n '1,200p' 'src/app/api/pro/businesses/[businessId]/settings/route.ts' — inspect settings API.
42. sed -n '1,220p' src/app/api/personal/transactions/route.ts — inspect personal transactions API.
43. sed -n '1,220p' src/app/api/auth/login/route.ts — inspect login API.
44. rg "rateLimit" src/app/api/auth/register/route.ts && sed -n '1,120p' src/app/api/auth/register/route.ts — inspect register API rate limiting/CSRF.
45. sed -n '1,200p' 'src/app/api/pro/businesses/[businessId]/accounting/client/[clientId]/summary/route.ts' — review accounting summary API.
46. nl -ba src/components/pro/clients/ClientInfoTab.tsx | sed -n '20,120p' — capture line numbers for UI evidence.
47. nl -ba 'src/app/api/pro/businesses/[businessId]/clients/[clientId]/route.ts' | sed -n '180,320p' — capture line numbers for missing sector handling.
48. nl -ba src/app/api/dev/seed/route.ts — capture line numbers for dev seed endpoint.
49. sed -n '1,200p' 'src/app/api/personal/accounts/[accountId]/route.ts' — review personal account detail API.
50. nl -ba src/pages/__placeholder__.tsx — capture placeholder page evidence.
51. sed -n '1,200p' src/app/globals.css — inspect design tokens/theme definitions.
52. ls src/components/ui — list UI primitives.
53. sed -n '1,120p' 'src/app/(marketing)/page.tsx' — review marketing homepage layout/components.
54. sed -n '1,80p' src/app/app/personal/page.tsx — review personal home layout/style.
55. node - <<'EOF' ... (write ORPHANS_PAGES.json / ORPHANS_API.json from ROUTES_PAGES.csv) — emit orphan JSON artifacts.
56. node - <<'EOF' ... (compute top 30 largest files) — write AUDIT/LARGEST_FILES.csv.
57. pnpm -s lint — lint after project page changes.
58. pnpm -s typecheck — typecheck after project page changes.
59. pnpm -s lint — lint after Projets UX updates.
60. pnpm -s typecheck — typecheck after Projets UX updates.
